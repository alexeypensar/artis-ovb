<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Калькулятор</title>
    <link rel="stylesheet" href="main.css">
    <link rel="shortcut icon" href="favicon.ico">
</head>
<body>


<section class="calculator" id="calculator">
    <div>
        <label for="city">Куда летим:</label>
        <input autocomplete="off" id="city" type="text" v-model="city">
    </div>
    <div>
        <label for="weight">Вес:</label>
        <input autocomplete="off" type="number" v-model="weight" id="weight">
    </div>
    <div>
        <label for="volume">Объём:</label>
        <input autocomplete="off" type="number" step="0.1" v-model="volume" id="volume">
    </div>
<!--    <div class="expedition__checkbox">-->

<!--&lt;!&ndash;        <label class="c-custom-checkbox">&ndash;&gt;-->

<!--&lt;!&ndash;            <input type="checkbox" id="expeditionCheckbox">&ndash;&gt;-->
<!--&lt;!&ndash;            <svg width="34" height="34" viewBox="-4 -4 45 45" aria-hidden="true" focusable="false">&ndash;&gt;-->
<!--&lt;!&ndash;                &lt;!&ndash; The background &ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;                <rect class="cb-bg" width="40" height="40" x="-2" y="-2" stroke="currentColor" fill="none" stroke-width="3"&ndash;&gt;-->
<!--&lt;!&ndash;                      rx="6" ry="6"></rect>&ndash;&gt;-->
<!--&lt;!&ndash;                &lt;!&ndash; The checkmark&ndash;&gt;&ndash;&gt;-->
<!--&lt;!&ndash;                <polyline class="cb-cm" points="6,16 14,25 30,7" stroke="transparent" stroke-width="4" fill="none"></polyline>&ndash;&gt;-->
<!--&lt;!&ndash;            </svg>&ndash;&gt;-->

<!--&lt;!&ndash;            <span>Забор груза</span>&ndash;&gt;-->


<!--&lt;!&ndash;        </label>&ndash;&gt;-->

<!--        <label><input id="expeditionCheckbox" type="checkbox" checked> Забор груза</label>-->
<!--    </div>-->
    <button @click="calc()" id="go">Рассчитать</button>


</section>

<div class="desperation" id="desperation">

</div>

<div class="results" id="results">


</div>

<script>


</script>

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script>
    var calculator = new Vue({
        el: '#calculator',
        methods: {
            getPrice: function() {

                // let priceList = [];

                fetch('src/price.json')
                    .then((response) => {
                        return response.json();
                    })
                    .then((data) => {
                        this.priceList = data;
                    });
            },

            calc: function () {


                this.getPrice();

                document.getElementById('desperation').innerHTML = '';
                document.getElementById('results').innerHTML = '';


                let weight = this.weight;
                let city = this.city;
                const terminal = this.terminal;
                let volume = this.volume;

                // let expedition = this.expedition;



                let filteredArray = this.priceList.filter((el) => {
                    return el.targetCity.charAt(0).toUpperCase() + el.targetCity.substr(1).toLowerCase() === city.charAt(0).toUpperCase() + city.substr(1).toLowerCase();
                });

                if (filteredArray.length === 0) {
                    document.getElementById('results').innerText = 'Город-получатель не найден';
                } else {

                    filteredArray.forEach((el) => {
                        if ((city.charAt(0).toUpperCase() + city.substr(1).toLowerCase()) === (el.targetCity.charAt(0).toUpperCase() + el.targetCity.substr(1).toLowerCase())) {


                            if (+volume * 167 > weight) {
                                weight = volume * 167;
                            }
                            if (weight < el.minWeight) {
                                weight = el.minWeight;
                            }


                            this.airPrice = +weight * +el.price;
                            this.terminalPrice = (+weight * terminal);

                            if (this.terminalPrice < this.minTerminal) {
                                this.terminalPrice = this.minTerminal;
                            }


                            this.waybillPrice = el.waybill;
                            this.showDispatcher = el.dispatcher;
                            this.result = +this.airPrice + +this.terminalPrice + +this.waybillPrice;
                            el.transferCity !== '' ? this.transferCity = el.transferCity : this.transferCity = '';

                            let resultsBlock = document.getElementsByClassName('results')[0];
                            let wrapper = document.createElement('article');

                            // todo не забыть стоимость экспедирования добавить к общей стоимости


                            let zeroth = document.createElement('img');
                            let second = document.createElement('p');
                            let fourth = document.createElement('p');
                            let fifth = document.createElement('p');
                            let sixth = document.createElement('p');
                            // let sixthandahalf = document.createElement('p');
                            let seventh = document.createElement('b');


                            let resultsAirlines = document.createElement('section');
                            resultsAirlines.classList.add('results__airlines');


                            resultsBlock.appendChild(wrapper);

                            wrapper.appendChild(resultsAirlines);

                            resultsAirlines.appendChild(zeroth);
                            resultsAirlines.appendChild(second);


                            wrapper.appendChild(fourth);
                            wrapper.appendChild(fifth);
                            wrapper.appendChild(sixth);
                            // wrapper.appendChild(sixthandahalf);





                            wrapper.appendChild(seventh);



                            // expeditionCheckbox.addEventListener('change', function() {
                            //     if (expeditionCheckbox.checked) {
                            //         console.log('нужен забор')
                            //     }
                            //     else {
                            //         console.log('не нужен забор')
                            //     }
                            // });

                            if (this.showDispatcher === 'Аэрофлот') {
                                seventh.innerHTML = ('Итого: ' + this.result.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + ' ' + '&#8381;';
                                zeroth.setAttribute('src', 'img/aeroflot.png');
                                zeroth.setAttribute('alt', 'Аэрофлот');
                            } else if (this.showDispatcher === 'S7') {
                                seventh.innerHTML = ('Итого: ' + (this.result - this.terminalPrice).toFixed(0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ")) + ' ' + '&#8381;';
                                this.terminalPrice = 0;
                                wrapper.removeChild(fifth);
                                zeroth.setAttribute('src', 'img/s7.png');
                                zeroth.setAttribute('alt', 'S7');
                            } else if (this.showDispatcher === 'Уральские авиалинии') {
                                zeroth.setAttribute('src', 'img/ural.png');
                                zeroth.setAttribute('alt', 'Уральские Авиалинии');
                                seventh.innerHTML = ('Итого: ' + this.result.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + ' ' + '&#8381;';
                            } else if (this.showDispatcher === 'NordStar') {
                                zeroth.setAttribute('src', 'img/nordstar.png');
                                zeroth.setAttribute('alt', 'NordStar');
                                seventh.innerHTML = ('Итого: ' + this.result.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + ' ' + '&#8381;';
                            } else if (this.showDispatcher === 'Ямал') {
                                zeroth.setAttribute('src', 'img/yamal.png');
                                zeroth.setAttribute('alt', 'Ямал');
                                seventh.innerHTML = ('Итого: ' + this.result.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + ' ' + '&#8381;';
                            } else if (this.showDispatcher === 'ИрАэро') {
                                zeroth.setAttribute('src', 'img/iraero.png');
                                zeroth.setAttribute('alt', 'ИрАэро');
                                seventh.innerHTML = ('Итого: ' + this.result.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + ' ' + '&#8381;';
                            } else {
                                seventh.innerHTML = ('Итого: ' + this.result.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ") + ' ' + '&#8381;';
                            }


                            if (this.transferCity !== '') {
                                second.textContent = 'Трансфер: ' + this.transferCity;
                            }
                            fourth.textContent = ('Стоимость перелёта: ' + this.airPrice.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                            fifth.textContent = ('Терминальная обработка: ' + this.terminalPrice.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                            sixth.textContent = ('Оформление ГАН: ' + this.waybillPrice).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                            // sixthandahalf.textContent = ('Забор по Новосибирску: ' + maxPrice.toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");


                        }


                    });


                    // let expeditionPrice = function() {
                    //     let expeditionCheckbox = document.getElementById('expeditionCheckbox');
                    //     let expeditionArray = [];
                    //     if (expeditionCheckbox.checked) {
                    //
                    //
                    //
                    //
                    //         if (weight <= 50) {
                    //             expeditionArray.push(expedition[0]);
                    //         } else if (weight > 50 && weight <= 100) {
                    //             expeditionArray.push(expedition[1]);
                    //         } else if (weight > 100 && weight <= 500) {
                    //             expeditionArray.push(expedition[2]);
                    //         } else if (weight > 500 && weight <= 1000) {
                    //             expeditionArray.push(expedition[3]);
                    //         } else if (weight > 1000 && weight <= 1500) {
                    //             expeditionArray.push(expedition[4]);
                    //         } else {
                    //             expeditionArray.push('Стоимость экспедирования - по согласованию');
                    //         }
                    //
                    //
                    //         if (volume <= 0.3) {
                    //             expeditionArray.push(expedition[0]);
                    //         } else if (volume > 0.3 && volume <= 0.6) {
                    //             expeditionArray.push(expedition[1]);
                    //         } else if (volume > 0.6 && volume <= 3) {
                    //             expeditionArray.push(expedition[2]);
                    //         } else if (volume > 3 && volume <= 4.5) {
                    //             expeditionArray.push(expedition[3]);
                    //         } else if (volume > 4.5 && volume <= 7.5) {
                    //             expeditionArray.push(expedition[4]);
                    //         } else {
                    //             expeditionArray.push('Стоимость экспедирования - по согласованию');
                    //         }
                    //
                    //         console.log(expeditionArray);
                    //
                    //
                    //         if(expeditionArray[0] instanceof Number && expeditionArray[1] instanceof Number) {
                    //             let maxPrice = Math.max.apply(Math, expeditionArray);
                    //         }
                    //         else if (expeditionArray[0] instanceof String && expeditionArray[1] instanceof Number ) {
                    //             let maxPrice = expeditionArray[0];
                    //         }
                    //         else if (expeditionArray[0] instanceof Number && expeditionArray[1] instanceof String) {
                    //             let maxPrice = expeditionArray[1];
                    //         }
                    //         else {
                    //             let maxPrice = expeditionArray[0];
                    //         }
                    //
                    //         // todo проблема в области видимости переменной maxPriceo
                    //
                    //     }
                    //
                    //
                    //
                    //
                    //
                    //
                    //     //     else if((weight > 50 && weight <= 100) && (volume > 0.3 && volume <= 0.6)) {
                    //     //         sixthandahalf.textContent = ('Забор по Новосибирску: ' + this.expedition[1].toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                    //     //     }
                    //     //     else if((weight > 101 && weight <= 500) && (volume > 0.6 && volume <= 3)) {
                    //     //         sixthandahalf.textContent = ('Забор по Новосибирску: ' + this.expedition[2].toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                    //     //     }
                    //     //     else if((weight > 501 && weight <= 1000) && (volume > 3 && volume <= 4.5)) {
                    //     //         sixthandahalf.textContent = ('Забор по Новосибирску: ' + this.expedition[3].toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                    //     //     }
                    //     //     else if((weight > 1001 && weight <= 1500) && (volume > 4.5 && volume <= 7.5)) {
                    //     //         sixthandahalf.textContent = ('Забор по Новосибирску: ' + this.expedition[4].toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                    //     //     }
                    //     //     else {
                    //     //         sixthandahalf.textContent = 'Стоимость экспедирования - по согласованию';
                    //     //     }
                    //     //
                    //     // }
                    //
                    //     // sixthandahalf.textContent = ('Забор по Новосибирску: ' + this.expedition[0].toFixed(0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
                    // };

                    // expeditionPrice();

                    let desperation = document.getElementById('desperation');
                    let desperationText = document.createElement('p');
                    desperationText.style.margin = '0';
                    desperation.appendChild(desperationText);

                    let arrow = document.createElement('img');
                    arrow.setAttribute('src', 'img/arrow.svg');
                    arrow.setAttribute('alt', 'стрелка вправо');
                    desperationText.innerHTML = 'Новосибирск  ' + '<img src="img/arrow.svg" alt="">  ' + city.charAt(0).toUpperCase() + city.substr(1).toLowerCase();


                }







            }


        },


        data: {
            city: '',
            weight: '',
            volume: '',
            result: 0,
            terminal: 8,
            minTerminal: 243.4,
            airPrice: 0,
            terminalPrice: 0,
            waybillPrice: 0,
            waybill: 0,
            showDispatcher: '',
            transferCity: '',
            filteredArray: [],
            resultsBlock: '',
            expedition: [800, 900, 1700, 2700, 3500],
            priceList: []

        }

    });


</script>

</body>
</html>